#pragma once

/*==============================================================================
Sliding window.
==============================================================================*/

#include "dspSlidingWindow.h"

//******************************************************************************
//******************************************************************************
//******************************************************************************

namespace Dsp
{

//******************************************************************************
//******************************************************************************
//******************************************************************************
// This template implements a sliding window that maintains a history of
// input values and calculates the minimum, maximum, and mean on it.

template <typename T,int WinSize>
class SlidingMinMax : public SlidingWindow<T, WinSize>
{
public:
   typedef SlidingWindow<T, WinSize> BaseClass;

   //***************************************************************************
   //***************************************************************************
   //***************************************************************************
   // Members.

   // Output variables.
   T mMin;          // Minimum of window values.
   T mMax;          // Maximum of window values.

   //***************************************************************************
   //***************************************************************************
   //***************************************************************************
   // Methods.

   // Constructor.
   SlidingMinMax()
   {
      reset();
   }

   void reset() override
   {
      BaseClass::reset();
      mMin = 0;
      mMax = 0;
   }

   //***************************************************************************
   //***************************************************************************
   //***************************************************************************
   // This is called by the base class put operation after the actual put.

   void doAfterPut() override
   {
      //************************************************************************
      //************************************************************************
      //************************************************************************
      // Calculate the min and max.

      // Loop through all of the occupied elements to obtain
      // the minimums and maximums.
      for (int i = 0; i < BaseClass::mSize; i++)
      {
         T tValue = BaseClass::elementAt(i);
         if (i==0)
         {
            mMin = tValue;
            mMax = tValue;
         }
         else
         {
            if (tValue < mMin) mMin = tValue;
            if (tValue > mMax) mMax = tValue;
         }
      }
   }
};

//******************************************************************************
//******************************************************************************
//******************************************************************************
}//namespace

