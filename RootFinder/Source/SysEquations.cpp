/*==============================================================================
Description:
==============================================================================*/

//******************************************************************************
//******************************************************************************
//******************************************************************************

#include "prnPrint.h"
#include "dsp_math.h"

#include "SysEquations.h"
//******************************************************************************
//******************************************************************************
//******************************************************************************
// Constructor.

SysEquations::SysEquations()
{
   reset();
}

SysEquations::SysEquations(Special_Parms& aP)
{
   mP = aP;
   reset();
}

void SysEquations::initialize(Special_Parms& aP)
{
   mP = aP;
   reset();
}

void SysEquations::reset()
{
   mX0 = 0;
   mY0 = 0;

   mA120= 0;
   mA121= 0;
   mA122= 0;
   mA340= 0;
   mA341= 0;
   mA342= 0;

   mB120= 0;
   mB121= 0;
   mB122= 0;
   mB340= 0;
   mB341= 0;
   mB342= 0;
}

//******************************************************************************
//******************************************************************************
//******************************************************************************

void SysEquations::evaluateFunction(
   Eigen::VectorXd& aX,          // Input
   Eigen::VectorXd& aY)                               // Output
{
   aY(0) = (1 - aX(1))*(mA120 + mA121*aX(0) + mA122*aX(0)*aX(0)) + aX(1)*(mA340 + mA341*aX(0) + mA342*aX(0)*aX(0)) - mX0;
   aY(1) = (1 - aX(0))*(mB120 + mB121*aX(1) + mB122*aX(1)*aX(1)) + aX(0)*(mB340 + mB341*aX(1) + mB342*aX(1)*aX(1)) - mY0;

}

// This evaluates the jacobian of the function at the input value array.
void SysEquations::evaluateJacobian(
   Eigen::VectorXd& aX,                 // Input
   Eigen::MatrixXd& aJacobian)          // Output
// J = [{dY0/dX0, dY0/dX1},{dY1/dX0, dY1/dX1} ]
{
   aJacobian(0, 0) = (1 - aX(1))*mA121 + 2 * (1 - aX(1))*mA122*aX(0) + aX(1)*mA341 + 2 * aX(1)*mA342*aX(0);
   aJacobian(0, 1) = mA120 + mA121*aX(0) + mA122*aX(0)*aX(0) + mA340 + mA341*aX(0) + mA342*aX(0)*aX(0);
   aJacobian(1, 0) = mB120 + mB121*aX(1) + mB122*aX(1)*aX(1) + mB340 + mB341*aX(1) + mB342*aX(1)*aX(1);
   aJacobian(1, 1) = (1 - aX(0))*mB121 + 2 * (1 - aX(0))*mB122*aX(1) + aX(0)*mB341 + 2 * aX(0)*mB342*aX(1);
}

//******************************************************************************
//******************************************************************************
//******************************************************************************

